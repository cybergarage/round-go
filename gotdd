#/bin/sh

export GOPATH=`pwd`

fswatch=`which fswatch`
inotifywait=`which inotifywait`

srcdir="src"
pkgname=`ls -1 ${srcdir}`
exreg=".*\.sw[pox]"

# For fswatch 

if [ ${#fswatch} -gt 0 ]; then
  ${fswatch} -o -e '${exreg}' ${srcdir} | xargs -n1 -I{} go test -v ${pkgname}
  exit 0
fi

# For inotifywait

if [ ${#inotifywait} -gt 0 ]; then
  while ${inotifywait} -qr -e modify --exclude '${exreg}' ${srcdir}; do
    go test -v ${pkgname}
  done
fi

exit 1
